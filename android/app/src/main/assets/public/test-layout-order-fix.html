<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¸ƒå±€é¡ºåºä¿®å¤æµ‹è¯•</title>
    <style>
        :root {
            --bg: #f5f7fa;
            --panel-bg: white;
            --text: #1e293b;
            --muted: #64748b;
            --accent: #6366f1;
            --accent-hover: #5558e3;
            --accent-light: #e0e7ff;
            --border: #e2e8f0;
            --radius: 12px;
            --radius-sm: 8px;
            --font: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: var(--font);
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .test-header {
            background: linear-gradient(135deg, var(--accent) 0%, #8b5cf6 100%);
            color: white;
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .test-header h1 {
            margin: 0;
            font-size: 1.8rem;
            font-weight: 700;
        }

        .test-header p {
            margin: 8px 0 0 0;
            opacity: 0.9;
        }

        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .test-section {
            background: var(--panel-bg);
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }

        .test-section h2 {
            color: var(--accent);
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .test-iframe {
            width: 100%;
            height: 600px;
            border: 2px solid var(--border);
            border-radius: var(--radius-sm);
            background: white;
        }

        .test-controls {
            margin-bottom: 15px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .test-btn {
            padding: 8px 16px;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
        }

        .test-btn:hover {
            background: var(--accent-hover);
            transform: translateY(-1px);
        }

        .test-btn.secondary {
            background: transparent;
            color: var(--muted);
            border: 1px solid var(--border);
        }

        .test-btn.secondary:hover {
            background: var(--accent-light);
            color: var(--accent);
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-indicator.success {
            background: #22c55e;
        }

        .status-indicator.error {
            background: #ef4444;
        }

        .status-indicator.warning {
            background: #f59e0b;
        }

        .layout-status {
            padding: 10px 15px;
            border-radius: var(--radius-sm);
            margin: 10px 0;
            font-weight: 500;
        }

        .layout-status.success {
            background: #f0fdf4;
            color: #166534;
            border: 1px solid #bbf7d0;
        }

        .layout-status.error {
            background: #fef2f2;
            color: #dc2626;
            border: 1px solid #fecaca;
        }

        .layout-status.warning {
            background: #fffbeb;
            color: #92400e;
            border: 1px solid #fed7aa;
        }

        .checklist {
            background: #f8fafc;
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            padding: 15px;
            margin: 15px 0;
        }

        .checklist h3 {
            margin: 0 0 10px 0;
            color: var(--text);
            font-size: 1.1rem;
        }

        .checklist ul {
            margin: 0;
            padding-left: 20px;
        }

        .checklist li {
            margin: 5px 0;
            color: var(--text);
        }

        .checklist li.pass {
            color: #166534;
        }

        .checklist li.fail {
            color: #dc2626;
        }

        .responsive-test {
            display: flex;
            gap: 15px;
            margin: 15px 0;
            flex-wrap: wrap;
        }

        .responsive-device {
            flex: 1;
            min-width: 300px;
            border: 2px solid var(--border);
            border-radius: var(--radius);
            padding: 15px;
            background: white;
        }

        .responsive-device h4 {
            margin: 0 0 10px 0;
            color: var(--accent);
        }

        .device-iframe {
            width: 100%;
            height: 400px;
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
        }

        @media (max-width: 768px) {
            .test-container {
                padding: 15px;
            }

            .test-iframe {
                height: 500px;
            }

            .responsive-device {
                min-width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="test-header">
        <h1>ğŸ”§ å¸ƒå±€é¡ºåºä¿®å¤æµ‹è¯•</h1>
        <p>éªŒè¯å¿«æ·åŒºåŸŸå’Œè¾“å…¥æ¡†å§‹ç»ˆç½®äºæ–‡å­—åŒºä¸‹æ–¹çš„å¸ƒå±€ä¿®å¤æ•ˆæœ</p>
    </div>

    <div class="test-container">
        <!-- ä¸»è¦æµ‹è¯•åŒºåŸŸ -->
        <div class="test-section">
            <h2><span class="status-indicator success"></span>å®æ—¶å¸ƒå±€éªŒè¯</h2>
            
            <div class="test-controls">
                <button class="test-btn" onclick="refreshMainTest()">ğŸ”„ åˆ·æ–°æµ‹è¯•</button>
                <button class="test-btn secondary" onclick="checkLayoutOrder()">ğŸ“‹ æ£€æŸ¥å¸ƒå±€é¡ºåº</button>
                <button class="test-btn secondary" onclick="simulateMobileMode()">ğŸ“± æ¨¡æ‹Ÿç§»åŠ¨ç«¯</button>
                <button class="test-btn secondary" onclick="forceLayoutCheck()">ğŸ” å¼ºåˆ¶å¸ƒå±€æ£€æŸ¥</button>
            </div>

            <div id="layout-status" class="layout-status success">
                âœ… å¸ƒå±€ç›‘æ§ç³»ç»Ÿå·²å¯åŠ¨ï¼Œæ­£åœ¨å®æ—¶ç›‘æ§...
            </div>

            <iframe id="main-test" class="test-iframe" src="index.html"></iframe>
        </div>

        <!-- å“åº”å¼æµ‹è¯• -->
        <div class="test-section">
            <h2><span class="status-indicator warning"></span>å“åº”å¼å¸ƒå±€æµ‹è¯•</h2>
            
            <div class="responsive-test">
                <div class="responsive-device">
                    <h4>ğŸ“± ç§»åŠ¨ç«¯ç«–å± (375px)</h4>
                    <iframe class="device-iframe" src="index.html" style="width: 375px; height: 667px; transform: scale(0.8); transform-origin: top left;"></iframe>
                </div>
                
                <div class="responsive-device">
                    <h4>ğŸ“± ç§»åŠ¨ç«¯æ¨ªå± (667px)</h4>
                    <iframe class="device-iframe" src="index.html" style="width: 667px; height: 375px; transform: scale(0.6); transform-origin: top left;"></iframe>
                </div>
                
                <div class="responsive-device">
                    <h4>ğŸ’» æ¡Œé¢ç«¯ (1200px)</h4>
                    <iframe class="device-iframe" src="index.html"></iframe>
                </div>
            </div>
        </div>

        <!-- å¸ƒå±€æ£€æŸ¥æ¸…å• -->
        <div class="test-section">
            <h2><span class="status-indicator success"></span>å¸ƒå±€éªŒè¯æ¸…å•</h2>
            
            <div class="checklist">
                <h3>âœ… åŸºæœ¬å¸ƒå±€è¦æ±‚</h3>
                <ul id="basic-checks">
                    <li>æ¸¸æˆæ ‡é¢˜ (order: 0) - åœ¨æœ€é¡¶éƒ¨</li>
                    <li>æ–‡å­—è¾“å‡ºåŒºåŸŸ (order: 1) - åœ¨æ ‡é¢˜ä¸‹æ–¹</li>
                    <li>åŠ¨æ€é€‰æ‹©æŒ‰é’® (order: 2) - åœ¨æ–‡å­—åŒºåŸŸä¸‹æ–¹</li>
                    <li>å¿«æ·æŒ‰é’®åŒºåŸŸ (order: 3) - åœ¨é€‰æ‹©æŒ‰é’®ä¸‹æ–¹</li>
                    <li>è¾“å…¥åŒºåŸŸ (order: 4) - åœ¨æœ€åº•éƒ¨</li>
                </ul>
            </div>

            <div class="checklist">
                <h3>ğŸ”§ å¼ºåŒ–çº¦æŸæ£€æŸ¥</h3>
                <ul id="constraint-checks">
                    <li>æ‰€æœ‰åŒºåŸŸéƒ½æœ‰ position: relative</li>
                    <li>æ‰€æœ‰åŒºåŸŸéƒ½æœ‰ width: 100%</li>
                    <li>å¿«æ·åŒºåŸŸå’Œè¾“å…¥åŒºåŸŸæœ‰ clear: both</li>
                    <li>å¿«æ·åŒºåŸŸå’Œè¾“å…¥åŒºåŸŸæœ‰æ­£ç¡®çš„ z-index</li>
                    <li>å®¹å™¨æœ‰ isolation: isolate å±æ€§</li>
                </ul>
            </div>

            <div class="checklist">
                <h3>ğŸ“± ç§»åŠ¨ç«¯ç‰¹å®šæ£€æŸ¥</h3>
                <ul id="mobile-checks">
                    <li>å¿«æ·æŒ‰é’®ä½¿ç”¨ grid å¸ƒå±€ (2è¡ŒÃ—4åˆ—)</li>
                    <li>ç§»åŠ¨ç«¯æ–­ç‚¹ä¸‹ order å±æ€§å¼ºåˆ¶ç”Ÿæ•ˆ</li>
                    <li>è§¦æ‘¸è®¾å¤‡ä¼˜åŒ–æ­£å¸¸å·¥ä½œ</li>
                    <li>è¾“å…¥åŒºåŸŸåœ¨ç§»åŠ¨ç«¯ä¿æŒåº•éƒ¨ä½ç½®</li>
                </ul>
            </div>
        </div>

        <!-- å®æ—¶ç›‘æ§æ—¥å¿— -->
        <div class="test-section">
            <h2><span class="status-indicator warning"></span>å®æ—¶ç›‘æ§æ—¥å¿—</h2>
            
            <div id="monitor-log" style="background: #f8fafc; border: 1px solid var(--border); border-radius: var(--radius-sm); padding: 15px; height: 200px; overflow-y: auto; font-family: monospace; font-size: 12px;">
                <div style="color: #64748b;">ç­‰å¾…å¸ƒå±€ç›‘æ§ç³»ç»Ÿå¯åŠ¨...</div>
            </div>
        </div>
    </div>

    <script>
        let checkCount = 0;
        let layoutErrors = 0;
        
        // å¸ƒå±€æ£€æŸ¥å‡½æ•°
        function checkLayoutOrder() {
            const iframe = document.getElementById('main-test');
            const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
            
            if (!iframeDoc) {
                updateStatus('æ— æ³•è®¿é—®iframeå†…å®¹ï¼Œè¯·æ£€æŸ¥åŒæºç­–ç•¥', 'error');
                return;
            }

            const container = iframeDoc.querySelector('.container');
            if (!container) {
                updateStatus('æ‰¾ä¸åˆ°å®¹å™¨å…ƒç´ ', 'error');
                return;
            }

            const elements = [
                { selector: '#game-title', expectedOrder: 0, name: 'æ¸¸æˆæ ‡é¢˜' },
                { selector: '#output', expectedOrder: 1, name: 'æ–‡å­—è¾“å‡ºåŒºåŸŸ' },
                { selector: '#choices', expectedOrder: 2, name: 'åŠ¨æ€é€‰æ‹©æŒ‰é’®' },
                { selector: '.quick-actions', expectedOrder: 3, name: 'å¿«æ·æŒ‰é’®åŒºåŸŸ' },
                { selector: '#input-area', expectedOrder: 4, name: 'è¾“å…¥åŒºåŸŸ' }
            ];

            let allCorrect = true;
            let results = [];

            elements.forEach(({ selector, expectedOrder, name }) => {
                const element = container.querySelector(selector);
                if (element) {
                    const currentOrder = parseInt(window.getComputedStyle(element).order) || 0;
                    const isCorrect = currentOrder === expectedOrder;
                    
                    results.push({
                        name,
                        expected: expectedOrder,
                        actual: currentOrder,
                        correct: isCorrect
                    });

                    if (!isCorrect) {
                        allCorrect = false;
                        layoutErrors++;
                    }
                } else {
                    results.push({
                        name,
                        expected: expectedOrder,
                        actual: 'N/A',
                        correct: false,
                        missing: true
                    });
                    allCorrect = false;
                    layoutErrors++;
                }
            });

            // æ›´æ–°æ£€æŸ¥æ¸…å•
            updateChecklists(results);
            
            // æ›´æ–°çŠ¶æ€
            if (allCorrect) {
                updateStatus(`âœ… å¸ƒå±€æ£€æŸ¥é€šè¿‡ï¼æ‰€æœ‰å…ƒç´ éƒ½åœ¨æ­£ç¡®ä½ç½® (æ£€æŸ¥ #${++checkCount})`, 'success');
            } else {
                updateStatus(`âŒ å¸ƒå±€æ£€æŸ¥å¤±è´¥ï¼å‘ç° ${results.filter(r => !r.correct).length} ä¸ªé—®é¢˜ (æ£€æŸ¥ #${++checkCount})`, 'error');
            }

            // è®°å½•åˆ°æ—¥å¿—
            logToConsole(results);
        }

        // æ›´æ–°æ£€æŸ¥æ¸…å•
        function updateChecklists(results) {
            const basicChecks = document.getElementById('basic-checks');
            basicChecks.innerHTML = results.map(r => {
                const status = r.missing ? 'âŒ ç¼ºå¤±' : (r.correct ? 'âœ…' : 'âŒ');
                const className = r.correct ? 'pass' : 'fail';
                return `<li class="${className}">${status} ${r.name} (æœŸæœ›: ${r.expected}, å®é™…: ${r.actual})</li>`;
            }).join('');

            // æ£€æŸ¥å¼ºåŒ–çº¦æŸ
            const iframe = document.getElementById('main-test');
            const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
            
            if (iframeDoc) {
                const container = iframeDoc.querySelector('.container');
                const constraintChecks = [];
                
                if (container) {
                    const quickActions = container.querySelector('.quick-actions');
                    const inputArea = container.querySelector('#input-area');
                    
                    // æ£€æŸ¥çº¦æŸ
                    constraintChecks.push({
                        name: 'å®¹å™¨æœ‰ isolation: isolate',
                        check: window.getComputedStyle(container).isolation === 'isolate'
                    });
                    
                    if (quickActions) {
                        constraintChecks.push({
                            name: 'å¿«æ·åŒºåŸŸæœ‰ position: relative',
                            check: window.getComputedStyle(quickActions).position === 'relative'
                        });
                        constraintChecks.push({
                            name: 'å¿«æ·åŒºåŸŸæœ‰ clear: both',
                            check: window.getComputedStyle(quickActions).clear === 'both'
                        });
                    }
                    
                    if (inputArea) {
                        constraintChecks.push({
                            name: 'è¾“å…¥åŒºåŸŸæœ‰ position: relative',
                            check: window.getComputedStyle(inputArea).position === 'relative'
                        });
                        constraintChecks.push({
                            name: 'è¾“å…¥åŒºåŸŸæœ‰ clear: both',
                            check: window.getComputedStyle(inputArea).clear === 'both'
                        });
                    }
                }
                
                document.getElementById('constraint-checks').innerHTML = constraintChecks.map(c => {
                    const status = c.check ? 'âœ…' : 'âŒ';
                    const className = c.check ? 'pass' : 'fail';
                    return `<li class="${className}">${status} ${c.name}</li>`;
                }).join('');
            }
        }

        // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
        function updateStatus(message, type = 'success') {
            const statusDiv = document.getElementById('layout-status');
            const icons = {
                success: 'âœ…',
                error: 'âŒ',
                warning: 'âš ï¸'
            };
            
            statusDiv.className = `layout-status ${type}`;
            statusDiv.innerHTML = `${icons[type]} ${message}`;
        }

        // è®°å½•åˆ°æ§åˆ¶å°æ—¥å¿—
        function logToConsole(results) {
            const logDiv = document.getElementById('monitor-log');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.style.marginBottom = '5px';
            logEntry.innerHTML = `<span style="color: #64748b;">[${timestamp}]</span> å¸ƒå±€æ£€æŸ¥ #${checkCount}: ${results.filter(r => r.correct).length}/${results.length} é€šè¿‡`;
            
            logDiv.appendChild(logEntry);
            logDiv.scrollTop = logDiv.scrollHeight;
            
            // é™åˆ¶æ—¥å¿—æ¡ç›®æ•°é‡
            while (logDiv.children.length > 20) {
                logDiv.removeChild(logDiv.firstChild);
            }
        }

        // åˆ·æ–°æµ‹è¯•
        function refreshMainTest() {
            const iframe = document.getElementById('main-test');
            iframe.src = iframe.src;
            updateStatus('ğŸ”„ æ­£åœ¨åˆ·æ–°æµ‹è¯•é¡µé¢...', 'warning');
        }

        // æ¨¡æ‹Ÿç§»åŠ¨ç«¯
        function simulateMobileMode() {
            const iframe = document.getElementById('main-test');
            iframe.style.width = '375px';
            iframe.style.height = '667px';
            iframe.style.transform = 'scale(0.8)';
            iframe.style.transformOrigin = 'top left';
            iframe.style.margin = '0 auto';
            updateStatus('ğŸ“± å·²åˆ‡æ¢åˆ°ç§»åŠ¨ç«¯æ¨¡æ‹Ÿæ¨¡å¼', 'warning');
            
            // å»¶è¿Ÿæ£€æŸ¥å¸ƒå±€
            setTimeout(checkLayoutOrder, 1000);
        }

        // å¼ºåˆ¶å¸ƒå±€æ£€æŸ¥
        function forceLayoutCheck() {
            const iframe = document.getElementById('main-test');
            const iframeWindow = iframe.contentWindow;
            
            if (iframeWindow && typeof iframeWindow.enforceLayoutOrder === 'function') {
                iframeWindow.enforceLayoutOrder();
                updateStatus('ğŸ” å·²å¼ºåˆ¶æ‰§è¡Œå¸ƒå±€æ£€æŸ¥å’Œä¿®æ­£', 'success');
                
                // å»¶è¿Ÿå†æ¬¡æ£€æŸ¥
                setTimeout(checkLayoutOrder, 500);
            } else {
                updateStatus('âŒ æ— æ³•è®¿é—®å¸ƒå±€ä¿®æ­£å‡½æ•°ï¼Œè¯·ç­‰å¾…é¡µé¢å®Œå…¨åŠ è½½', 'error');
            }
        }

        // å¯åŠ¨è‡ªåŠ¨ç›‘æ§
        function startAutoMonitoring() {
            // åˆå§‹æ£€æŸ¥
            setTimeout(() => {
                checkLayoutOrder();
                updateStatus('ğŸš€ è‡ªåŠ¨ç›‘æ§ç³»ç»Ÿå·²å¯åŠ¨', 'success');
            }, 3000);
            
            // æ¯5ç§’è‡ªåŠ¨æ£€æŸ¥ä¸€æ¬¡
            setInterval(checkLayoutOrder, 5000);
        }

        // é¡µé¢åŠ è½½å®Œæˆåå¯åŠ¨ç›‘æ§
        window.addEventListener('load', () => {
            updateStatus('â³ æ­£åœ¨ç­‰å¾…æµ‹è¯•é¡µé¢åŠ è½½...', 'warning');
            startAutoMonitoring();
        });

        // ç›‘å¬iframeåŠ è½½å®Œæˆ
        document.getElementById('main-test').addEventListener('load', () => {
            updateStatus('ğŸ“„ æµ‹è¯•é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹æ£€æŸ¥...', 'warning');
            setTimeout(checkLayoutOrder, 1000);
        });
    </script>
</body>
</html>