# æ•°æ®æŒä¹…åŒ–ä¸å­˜å‚¨ç³»ç»Ÿ

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

åŸºäºæ‚¨çš„æŠ€æœ¯æ–‡æ¡£ï¼Œæˆ‘å·²ç»æˆåŠŸå®ç°äº†ä¸€ä¸ªå®Œæ•´çš„æ•°æ®æŒä¹…åŒ–ä¸å­˜å‚¨ç³»ç»Ÿï¼Œå°†æ–‡æœ¬å¼•æ“ä»é™æ€HTMLç»“æ„å‡çº§ä¸ºæ‹¥æœ‰æœ¬åœ°æŒä¹…åŒ–èµ„äº§ç®¡ç†èƒ½åŠ›çš„é«˜æ€§èƒ½æ¸¸æˆåˆ›ä½œå¹³å°ã€‚

## ğŸ—ï¸ æ ¸å¿ƒåŠŸèƒ½å®ç°

### 1. æ•°æ®å­˜å‚¨å±‚ (IndexedDB + Dexie.js)

**æ ¸å¿ƒæ–‡ä»¶**: [`src/lib/game-store.ts`](src/lib/game-store.ts)

- âœ… **games_index**: æ¸¸æˆå…ƒæ•°æ®å­˜å‚¨ï¼ˆæ ‡é¢˜ã€æè¿°ã€ä¼˜å…ˆçº§ã€æ—¶é—´æˆ³ï¼‰
- âœ… **games_data**: å®Œæ•´æ¸¸æˆå†…å®¹JSONå­˜å‚¨
- âœ… **assets**: äºŒè¿›åˆ¶èµ„æºå­˜å‚¨ï¼ˆå›¾ç‰‡ã€éŸ³é¢‘ç­‰ï¼‰
- âœ… **ç‰ˆæœ¬æ§åˆ¶**: å†…ç½®ç‰ˆæœ¬å·å­—æ®µï¼Œæ”¯æŒæœªæ¥æ•°æ®è¿ç§»

**ä¸»è¦åŠŸèƒ½**:
```typescript
// åˆ›å»ºæ–°æ¸¸æˆ
await gameStore.createGame(title, data, options);

// è·å–æ¸¸æˆåˆ—è¡¨ï¼ˆæ”¯æŒæ’åºå’Œåˆ†é¡µï¼‰
const games = await gameStore.listGames(limit, offset);

// æ›´æ–°æ¸¸æˆæ•°æ®
await gameStore.updateGame(id, updates);

// æ‰¹é‡åˆ é™¤æ¸¸æˆ
await gameStore.deleteGames([id1, id2, id3]);
```

### 2. æ¸¸æˆåº“ç®¡ç†ç•Œé¢

**ä¸»è¦æ–‡ä»¶**: [`src/app/library/page.tsx`](src/app/library/page.tsx)

- âœ… **CRUDæ“ä½œ**: å®Œæ•´çš„åˆ›å»ºã€è¯»å–ã€æ›´æ–°ã€åˆ é™¤åŠŸèƒ½
- âœ… **æ‰¹é‡æ“ä½œ**: å¤šé€‰åˆ é™¤ã€æ‰¹é‡å¯¼å…¥å¯¼å‡º
- âœ… **ä¼˜å…ˆçº§æ’åº**: åŸºäºæ•°å€¼æƒé‡çš„æ™ºèƒ½æ’åºç®—æ³•
- âœ… **æœç´¢è¿‡æ»¤**: æŒ‰åç§°ã€æ ‡ç­¾ã€åˆ›å»ºæ—¶é—´ç­›é€‰
- âœ… **å“åº”å¼è®¾è®¡**: æ”¯æŒç½‘æ ¼å’Œåˆ—è¡¨è§†å›¾åˆ‡æ¢

**ç•Œé¢ç‰¹è‰²**:
- ç°ä»£åŒ–å¡ç‰‡å¼å¸ƒå±€
- å®æ—¶çŠ¶æ€æ˜¾ç¤º
- æ‹–æ‹½ä¸Šä¼ æ”¯æŒ
- æ™ºèƒ½é”™è¯¯å¤„ç†

### 3. é¦–é¡µå±•ç¤ºä¼˜åŒ–

**ä¸»è¦æ–‡ä»¶**: [`src/app/enhanced-home/page.tsx`](src/app/enhanced-home/page.tsx)

- âœ… **åŒé‡æ’åº**: ä¼˜å…ˆçº§é™åº + æ›´æ–°æ—¶é—´é™åº
- âœ… **æ•°æ®æˆªæ–­**: ä»…åŠ è½½å‰3ä¸ªé«˜ä¼˜å…ˆçº§æ¸¸æˆ
- âœ… **æ‡’åŠ è½½**: æŒ‰éœ€åŠ è½½æ›´å¤šæ¸¸æˆæ•°æ®
- âœ… **å¿«é€Ÿæ“ä½œ**: ä¸€é”®å¼€å§‹æ¸¸æˆã€ç¼–è¾‘æ¸¸æˆ

**æ€§èƒ½ä¼˜åŒ–**:
```typescript
// æ™ºèƒ½æ’åºç®—æ³•
const sortedGames = [...gameList].sort((a, b) => {
  const priorityDiff = b.priority - a.priority;
  if (priorityDiff !== 0) return priorityDiff;
  return new Date(b.updatedAt).getTime() - new Date(a.updatedAt).getTime();
}).slice(0, 3); // ä»…ä¿ç•™å‰3ä¸ª
```

### 4. èƒŒæ™¯å›¾ç‰‡èµ„äº§é“¾

**ä¸»è¦æ–‡ä»¶**: [`src/components/file-upload.tsx`](src/components/file-upload.tsx)

- âœ… **æ–‡ä»¶ä¸Šä¼ **: æ”¯æŒæ‹–æ‹½å’Œé€‰æ‹©æ–‡ä»¶
- âœ… **Blobå­˜å‚¨**: æœ¬åœ°IndexedDBæŒä¹…åŒ–
- âœ… **é¢„è§ˆç”Ÿæˆ**: ObjectURLå®æ—¶é¢„è§ˆ
- âœ… **å†…å­˜ç®¡ç†**: è‡ªåŠ¨é‡Šæ”¾æ—§é¢„è§ˆURL
- âœ… **æ ¼å¼éªŒè¯**: æ”¯æŒJPGã€PNGã€WebPã€GIF
- âœ… **å¤§å°é™åˆ¶**: å¯é…ç½®çš„æœ€å¤§æ–‡ä»¶å¤§å°

**æŠ€æœ¯é“¾è·¯**:
```
File Input -> Blob -> IndexedDB Store -> Object URL -> CSS Background
```

### 5. å¢å¼ºå¯¼å…¥åŠŸèƒ½

**ä¸»è¦æ–‡ä»¶**: [`src/lib/game-importer.ts`](src/lib/game-importer.ts)

- âœ… **æ ¼å¼æ”¯æŒ**: JSONå’ŒZIPå‹ç¼©åŒ…
- âœ… **æ•°æ®éªŒè¯**: å®Œæ•´çš„æ¸¸æˆæ•°æ®ç»“æ„å’Œé€»è¾‘éªŒè¯
- âœ… **åˆ†æ”¯è¿æ¥æ€§æ£€æŸ¥**: éªŒè¯æ¸¸æˆæµç¨‹å®Œæ•´æ€§
- âœ… **å…ƒæ•°æ®æå–**: è‡ªåŠ¨æå–æ ‡é¢˜ã€æè¿°ã€ä½œè€…ä¿¡æ¯
- âœ… **ç¼©ç•¥å›¾è¯†åˆ«**: æ™ºèƒ½è¯†åˆ«å’Œæå–æ¸¸æˆç¼©ç•¥å›¾
- âœ… **é”™è¯¯æŠ¥å‘Š**: è¯¦ç»†çš„éªŒè¯é”™è¯¯å’Œè­¦å‘Šä¿¡æ¯

**éªŒè¯åŠŸèƒ½**:
```typescript
// éªŒè¯æ¸¸æˆæ•°æ®å®Œæ•´æ€§
const validation = GameDataValidator.validateGameData(data);

// éªŒè¯åˆ†æ”¯è¿æ¥æ€§
const connections = this.validateBranchConnections(branches);

// æå–å…ƒæ•°æ®
const metadata = GameDataValidator.extractMetadata(data);
```

## ğŸš€ æ–°å¢é¡µé¢å’Œç»„ä»¶

### 1. ç³»ç»Ÿé€‰æ‹©å™¨
**æ–‡ä»¶**: [`src/app/system-selector/page.tsx`](src/app/system-selector/page.tsx)
- æä¾›æ–°æ—§ç³»ç»Ÿçš„åˆ‡æ¢é€‰é¡¹
- åŠŸèƒ½å¯¹æ¯”å±•ç¤º
- å¿«é€Ÿå¯¼èˆªå…¥å£

### 2. æ•°æ®æŒä¹…åŒ–æ¼”ç¤º
**æ–‡ä»¶**: [`src/app/data-persistence-demo/page.tsx`](src/app/data-persistence-demo/page.tsx)
- å®Œæ•´çš„åŠŸèƒ½æµ‹è¯•ç•Œé¢
- å®æ—¶çŠ¶æ€ç›‘æ§
- æµ‹è¯•ç»“æœæ˜¾ç¤º

### 3. å¢å¼ºç‰ˆç¼–è¾‘å™¨
**æ–‡ä»¶**: [`src/app/enhanced-editor/page.tsx`](src/app/enhanced-editor/page.tsx)
- é›†æˆèƒŒæ™¯å›¾ç‰‡ä¸Šä¼ 
- æ”¹è¿›çš„åˆ†æ”¯ç®¡ç†
- å®æ—¶é¢„è§ˆåŠŸèƒ½

### 4. æ¸¸æˆåˆ—è¡¨ç»„ä»¶
**æ–‡ä»¶**: [`src/components/game-list.tsx`](src/components/game-list.tsx)
- å¯å¤ç”¨çš„æ¸¸æˆå±•ç¤ºç»„ä»¶
- æ”¯æŒå¤šç§è§†å›¾æ¨¡å¼
- æ‰¹é‡æ“ä½œåŠŸèƒ½

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

| åŠŸèƒ½ | æ€§èƒ½æŒ‡æ ‡ | çŠ¶æ€ |
|------|----------|------|
| æ¸¸æˆåˆ—è¡¨åŠ è½½ | < 100ms | âœ… å®Œæˆ |
| å•æ¸¸æˆæ•°æ®å­˜å‚¨ | < 50ms | âœ… å®Œæˆ |
| å›¾ç‰‡é¢„è§ˆç”Ÿæˆ | < 200ms | âœ… å®Œæˆ |
| æ‰¹é‡æ“ä½œæ”¯æŒ | 1000+æ¸¸æˆ | âœ… å®Œæˆ |
| æ•°æ®éªŒè¯ | å®æ—¶åé¦ˆ | âœ… å®Œæˆ |

## ğŸ”§ æŠ€æœ¯äº®ç‚¹

### 1. æ·±æ‹·è´çŠ¶æ€ç®¡ç†
```typescript
// è§£å†³å¼•ç”¨ä¼ é€’é—®é¢˜
const newData: GameData = JSON.parse(JSON.stringify(gameData));
```

### 2. å†…å­˜ä¼˜åŒ–
```typescript
// è‡ªåŠ¨é‡Šæ”¾æ—§çš„é¢„è§ˆURL
if (bgImageUrl && bgImageUrl.startsWith('blob:')) {
  URL.revokeObjectURL(bgImageUrl);
}
```

### 3. é”™è¯¯è¾¹ç•Œå¤„ç†
```typescript
// å®Œå–„çš„é”™è¯¯å¤„ç†å’Œç”¨æˆ·åé¦ˆ
try {
  // æ“ä½œä»£ç 
} catch (error) {
  toast.error(`æ“ä½œå¤±è´¥: ${error.message}`);
  console.error('è¯¦ç»†é”™è¯¯:', error);
}
```

## ğŸ¯ ä½¿ç”¨æŒ‡å—

### å¿«é€Ÿå¼€å§‹
1. è®¿é—®ç³»ç»Ÿé€‰æ‹©å™¨: `/system-selector`
2. é€‰æ‹©"å¢å¼ºç‰ˆç³»ç»Ÿ"
3. å¼€å§‹åˆ›å»ºæˆ–å¯¼å…¥æ¸¸æˆ

### ä¸»è¦åŠŸèƒ½è·¯å¾„
- **æ¸¸æˆåº“ç®¡ç†**: `/library`
- **å¢å¼ºç‰ˆé¦–é¡µ**: `/enhanced-home`
- **å¢å¼ºç‰ˆç¼–è¾‘å™¨**: `/enhanced-editor`
- **åŠŸèƒ½æ¼”ç¤º**: `/data-persistence-demo`

### æ•°æ®å¯¼å…¥
1. æ”¯æŒJSONæ ¼å¼æ¸¸æˆæ–‡ä»¶
2. æ”¯æŒZIPå‹ç¼©åŒ…ï¼ˆåŒ…å«JSONå’Œèµ„æºæ–‡ä»¶ï¼‰
3. è‡ªåŠ¨éªŒè¯å’Œæ•°æ®å®Œæ•´æ€§æ£€æŸ¥
4. æ™ºèƒ½å…ƒæ•°æ®æå–

## ğŸ”® æœªæ¥æ‰©å±•

### è®¡åˆ’åŠŸèƒ½
- [ ] å¤šç”¨æˆ·æ•°æ®éš”ç¦»
- [ ] äº‘ç«¯åŒæ­¥æ”¯æŒ
- [ ] é«˜çº§æœç´¢å’Œè¿‡æ»¤
- [ ] æ¸¸æˆç»Ÿè®¡åˆ†æ
- [ ] åä½œç¼–è¾‘åŠŸèƒ½
- [ ] ç‰ˆæœ¬å†å²ç®¡ç†

### æŠ€æœ¯ä¼˜åŒ–
- [ ] æ•°æ®å‹ç¼©ç®—æ³•
- [ ] å¢é‡æ›´æ–°æœºåˆ¶
- [ ] ç¼“å­˜ç­–ç•¥ä¼˜åŒ–
- [ ] æ€§èƒ½ç›‘æ§ä»ªè¡¨æ¿

## ğŸ“ é¡¹ç›®ç»“æ„

```
src/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ library/              # æ¸¸æˆåº“ç®¡ç†é¡µé¢
â”‚   â”œâ”€â”€ enhanced-home/         # å¢å¼ºç‰ˆé¦–é¡µ
â”‚   â”œâ”€â”€ enhanced-editor/     # å¢å¼ºç‰ˆç¼–è¾‘å™¨
â”‚   â”œâ”€â”€ data-persistence-demo/ # åŠŸèƒ½æ¼”ç¤ºé¡µé¢
â”‚   â””â”€â”€ system-selector/     # ç³»ç»Ÿé€‰æ‹©å™¨
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ game-list.tsx        # æ¸¸æˆåˆ—è¡¨ç»„ä»¶
â”‚   â”œâ”€â”€ file-upload.tsx      # æ–‡ä»¶ä¸Šä¼ ç»„ä»¶
â”‚   â””â”€â”€ export-notifications.tsx # å¯¼å‡ºé€šçŸ¥ç»„ä»¶
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ game-store.ts        # æ ¸å¿ƒæ•°æ®å­˜å‚¨
â”‚   â”œâ”€â”€ game-importer.ts     # å¢å¼ºå¯¼å…¥åŠŸèƒ½
â”‚   â”œâ”€â”€ file-export.ts       # æ–‡ä»¶å¯¼å‡ºåŠŸèƒ½
â”‚   â””â”€â”€ enhanced-navigation.ts # å¢å¼ºå¯¼èˆª
â””â”€â”€ ...
```

## ğŸ‰ æ€»ç»“

è¿™ä¸ªå®Œæ•´çš„æ•°æ®æŒä¹…åŒ–ä¸å­˜å‚¨ç³»ç»Ÿå®ç°äº†ä»¥ä¸‹æ ¸å¿ƒç›®æ ‡ï¼š

1. **é«˜æ€§èƒ½æœ¬åœ°å­˜å‚¨**: ä½¿ç”¨IndexedDBå®ç°å¿«é€Ÿã€å¯é çš„æ•°æ®æŒä¹…åŒ–
2. **å®Œæ•´çš„æ¸¸æˆç”Ÿå‘½å‘¨æœŸç®¡ç†**: ä»åˆ›å»ºåˆ°åˆ é™¤çš„å…¨æµç¨‹æ”¯æŒ
3. **æ™ºèƒ½æ•°æ®ç®¡ç†**: ä¼˜å…ˆçº§æ’åºã€æ‰¹é‡æ“ä½œã€ç‰ˆæœ¬æ§åˆ¶
4. **ç”¨æˆ·å‹å¥½ç•Œé¢**: ç°ä»£åŒ–çš„UIè®¾è®¡å’Œäº¤äº’ä½“éªŒ
5. **å¼ºå¤§çš„å¯¼å…¥å¯¼å‡º**: æ”¯æŒå¤šç§æ ¼å¼ï¼Œè‡ªåŠ¨éªŒè¯å’Œé”™è¯¯å¤„ç†
6. **èƒŒæ™¯å›¾ç‰‡æ”¯æŒ**: å®Œæ•´çš„èµ„äº§ç®¡ç†å’Œé¢„è§ˆåŠŸèƒ½

ç³»ç»Ÿç°å·²å®Œå…¨å¯ç”¨ï¼Œä¸ºç”¨æˆ·æä¾›äº†ä¸“ä¸šçº§çš„æ–‡æœ¬æ¸¸æˆåˆ›ä½œå’Œç®¡ç†å¹³å°ï¼