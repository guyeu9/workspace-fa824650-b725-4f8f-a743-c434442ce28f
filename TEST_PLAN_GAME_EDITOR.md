# 游戏编辑器功能测试计划

## 1. 测试目标

验证游戏编辑器的核心功能：
- 游戏文本生成与管理
- 支线（分支）创建与编辑
- 选项添加与逻辑连接
- 新老编辑界面的功能一致性
- 后台API数据处理逻辑

## 2. 测试范围

### 2.1 前端组件测试
- 老版编辑器 (`/game-editor`)
- 新版增强编辑器 (`/enhanced-editor`)

### 2.2 后端API测试
- 游戏数据保存API
- 游戏数据读取API
- 游戏列表API

### 2.3 数据存储测试
- IndexedDB存储逻辑
- SessionStorage临时存储
- 导入/导出功能

## 3. 测试场景

### 3.1 游戏基础信息管理

| 测试场景 | 预期行为 | 验证方法 |
|---------|---------|---------|
| 默认游戏数据初始化 | 正确设置标题"我的故事"、描述和空分支数组 | 检查初始状态 |
| 修改游戏标题 | 标题变更即时生效 | 输入测试文本并验证 |
| 修改游戏描述 | 描述变更即时生效 | 输入测试文本并验证 |
| 标题长度限制 | 超过最大长度时拒绝或截断 | 输入超长文本 |
| 描述特殊字符 | 支持特殊字符和表情符号 | 输入包含emoji的文本 |

### 3.2 分支（支线）管理

| 测试场景 | 预期行为 | 验证方法 |
|---------|---------|---------|
| 添加新分支 | 创建带唯一ID的新分支 | 检查分支数量和ID |
| 删除分支 | 从数组中移除指定分支 | 删除后检查剩余数量 |
| 编辑分支标题 | 更新分支的chapter字段 | 修改后验证新值 |
| 编辑场景描述 | 更新分支的scene_detail字段 | 修改后验证新值 |
| 分支重命名 | 确保重命名不影响关联的选项 | 修改后检查数据完整性 |
| 删除最后一个分支 | 阻止删除或保留至少一个分支 | 尝试删除并验证 |
| 分支排序 | 支持调整分支顺序 | 移动后验证顺序 |

### 3.3 选项（Choices）管理

| 测试场景 | 预期行为 | 验证方法 |
|---------|---------|---------|
| 添加选项 | 为当前分支创建新选项 | 检查选项数量 |
| 删除选项 | 从分支中移除指定选项 | 删除后验证剩余选项 |
| 编辑选项文本 | 更新选项的choice字段 | 修改后验证 |
| 设置目标分支 | 将选项链接到另一分支 | 设置next_branch并验证 |
| 设置结束标记 | 标记选项为游戏结束 | 设置end_game=true |
| 设置效果文本 | 添加选项的效果描述 | 添加后验证 |
| 选项目标验证 | 目标分支ID必须存在 | 设置无效ID并处理 |

### 3.4 背景图片管理

| 测试场景 | 预期行为 | 验证方法 |
|---------|---------|---------|
| 上传背景图片 | 图片上传并显示 | 测试上传流程 |
| 移除背景图片 | 清除背景图片设置 | 移除后验证 |
| 图片URL格式 | 接受有效的图片URL | 测试各种URL格式 |
| 大图片处理 | 正确处理大尺寸图片 | 测试图片大小限制 |

### 3.5 导入导出功能

| 测试场景 | 预期行为 | 验证方法 |
|---------|---------|---------|
| 导出游戏JSON | 生成正确的JSON文件 | 导出并解析验证结构 |
| 导入游戏JSON | 解析并加载游戏数据 | 导入后验证数据完整性 |
| 导入损坏文件 | 显示错误提示 | 导入无效文件 |
| 导入旧格式 | 兼容旧版本数据格式 | 测试版本兼容 |

### 3.6 数据持久化

| 测试场景 | 预期行为 | 验证方法 |
|---------|---------|---------|
| 保存到游戏库 | 数据正确保存到IndexedDB | 保存后读取验证 |
| 从游戏库加载 | 正确读取已保存的游戏 | 加载后验证数据 |
| 自动保存 | 修改后自动或手动保存 | 测试保存触发条件 |
| 历史记录 | 支持撤销/重做功能 | 测试undo/redo |

### 3.7 界面交互

| 测试场景 | 预期行为 | 验证方法 |
|---------|---------|---------|
| 响应式布局 | 不同屏幕尺寸正常显示 | 测试各种屏幕宽度 |
| 实时预览 | 切换预览模式查看效果 | 测试预览功能 |
| 键盘快捷键 | 支持常用快捷键 | 测试Ctrl+S等 |
| 表单验证 | 输入验证即时反馈 | 测试无效输入 |

## 4. 测试数据模板

### 4.1 最小有效游戏数据
```json
{
  "game_title": "测试游戏",
  "description": "测试描述",
  "branches": [
    {
      "branch_id": "start",
      "chapter": "第一章",
      "scene_detail": "故事开始...",
      "choices": []
    }
  ]
}
```

### 4.2 完整游戏数据示例
```json
{
  "game_title": "冒险之旅",
  "description": "一个关于探索的冒险故事",
  "author": "测试作者",
  "status": "draft",
  "branches": [
    {
      "branch_id": "start",
      "chapter": "第一章：起点",
      "scene_detail": "你站在一个岔路口前，两条路蜿蜒向远方...",
      "choices": [
        {
          "id": "c1",
          "choice": "向左走",
          "next_branch": "left_path",
          "effect": "你感到一阵寒意..."
        },
        {
          "id": "c2",
          "choice": "向右走",
          "next_branch": "right_path"
        }
      ]
    },
    {
      "branch_id": "left_path",
      "chapter": "第二章：森林",
      "scene_detail": "你进入了一片密林，阳光被树叶遮挡...",
      "choices": [
        {
          "id": "c3",
          "choice": "继续前进",
          "next_branch": "treasure",
          "effect": "你发现了宝藏！",
          "end_game": true
        }
      ]
    }
  ]
}
```

### 4.3 测试分支场景

#### 场景A：简单线性故事
- 3个分支
- 每个分支1-2个选项
- 1个结局

#### 场景B：多分支故事
- 5个分支
- 每个分支多个选项
- 多个结局分支
- 选项循环引用

#### 场景C：复杂网状结构
- 10+分支
- 分支间交叉引用
- 多个起点选项

## 5. 测试执行步骤

### 5.1 准备阶段
1. 清理测试环境（清除localStorage、IndexedDB）
2. 准备测试数据文件
3. 打开浏览器开发者工具

### 5.2 执行测试
1. 按场景逐一执行测试
2. 记录实际结果
3. 截图保存异常情况

### 5.3 验证项目
- 数据结构完整性
- 界面显示正确性
- 交互响应及时性
- 错误处理合理性

## 6. 回归测试清单

每次代码变更后需验证：
- [ ] 游戏创建功能正常
- [ ] 分支添加/删除正常
- [ ] 选项编辑正常
- [ ] 导入导出正常
- [ ] 保存加载正常
- [ ] 两个编辑器功能一致

## 7. 已知问题记录

| 问题描述 | 严重程度 | 状态 | 备注 |
|---------|---------|------|------|
| 新编辑器缺少撤销/重做 | 高 | 待修复 | 需添加history状态 |
| 分支删除后选项引用可能失效 | 中 | 待处理 | 需添加引用检查 |
| 大文件导入可能超时 | 低 | 已知限制 | 需添加加载提示 |
