<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="A modern text adventure game engine">
    <meta name="theme-color" content="#6366f1">
    <title>Text Engine - Modern UI</title>
    
    <!-- Preconnect for performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- Modern UI Styles -->
    <link rel="stylesheet" href="styles/modern-ui.css">
    <!-- Mobile Enhancements -->
    <link rel="stylesheet" href="styles/mobile-enhancements.css">
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <h1 class="app-title">Text Engine</h1>
                <div class="header-actions">
                    <button class="quick-btn" id="theme-toggle" aria-label="Toggle theme">üåô</button>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Quick Action Buttons -->
            <section class="quick-actions" aria-label="Quick actions">
                <button class="quick-btn" data-action="look">üëÅÔ∏è Look</button>
                <button class="quick-btn" data-action="items">üì¶ Items</button>
                <button class="quick-btn" data-action="inventory">üéí Inventory</button>
                <button class="quick-btn" data-action="go">üß≠ Go</button>
                <button class="quick-btn" data-action="help">‚ùì Help</button>
                <button class="quick-btn" data-action="save">üíæ Save</button>
                <button class="quick-btn" data-action="load">üìÇ Load</button>
                <button class="quick-btn" data-action="clear">üóëÔ∏è Clear</button>
            </section>

            <!-- Game Output Area -->
            <section class="game-output" aria-label="Game output" role="log" aria-live="polite">
                <!-- REQUIRED: Original text-engine output element -->
                <div id="output" class="output-content"></div>
            </section>

            <!-- Input Section -->
            <section class="input-section" aria-label="Command input">
                <div class="input-wrapper">
                    <div class="input-container">
                        <span class="input-prompt" aria-hidden="true">></span>
                        <!-- REQUIRED: Original text-engine input element -->
                        <input 
                            type="text" 
                            id="input" 
                            class="game-input" 
                            placeholder="Enter your command..." 
                            autofocus 
                            spellcheck="false"
                            autocomplete="off"
                            autocorrect="off"
                            autocapitalize="off"
                            aria-label="Enter command"
                        >
                    </div>
                    <button type="button" id="submit-btn" class="submit-btn" aria-label="Submit command">
                        <span>Execute</span>
                        <span aria-hidden="true">‚Üí</span>
                    </button>
                </div>
            </section>
        </main>

        <!-- Status Bar -->
        <footer class="status-bar">
            <div class="status-info">
                <div class="status-item">
                    <span aria-hidden="true">üìç</span>
                    <span id="current-room">Loading...</span>
                </div>
                <div class="status-item">
                    <span aria-hidden="true">‚è±Ô∏è</span>
                    <span id="timestamp">00:00:00</span>
                </div>
            </div>
            <div class="status-item">
                <span id="command-count">0 commands</span>
            </div>
        </footer>
    </div>

    <!-- Game Engine - MUST load before enhancements -->
    <script src="index.js"></script>
    
    <!-- Game Data -->
    <script src="game-disks/demo-disk.js"></script>
    
    <!-- Modern UI Enhancement Script -->
    <script>
        // Modern UI Enhancement for Text Engine
        class ModernUI {
            constructor() {
                this.commandCount = 0;
                this.currentRoom = 'Unknown';
                this.isDarkMode = false;
                this.init();
            }

            init() {
                console.log('ModernUI: Initializing...');
                
                // Wait for DOM and game engine to be ready
                if (document.readyState === 'loading') {
                    document.addEventListener('DOMContentLoaded', () => this.setup());
                } else {
                    this.setup();
                }
            }

            setup() {
                console.log('ModernUI: Setting up...');
                
                // Give the game engine time to initialize
                setTimeout(() => {
                    this.setupEventListeners();
                    this.setupQuickActions();
                    this.updateStatus();
                    this.enhancePrintln();
                    this.setupKeyboardShortcuts();
                    this.startClock();
                    console.log('ModernUI: Setup complete');
                }, 1000);
            }

            setupEventListeners() {
                const input = document.getElementById('input');
                const submitBtn = document.getElementById('submit-btn');
                
                if (!input || !submitBtn) {
                    console.error('ModernUI: Required elements not found');
                    return;
                }
                
                // Enhanced submit functionality
                const submitCommand = () => {
                    const command = input.value.trim();
                    if (command) {
                        this.incrementCommandCount();
                    }
                };

                // Submit button click
                submitBtn.addEventListener('click', submitCommand);
                
                // Enter key in input - let original handler handle it
                input.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        submitCommand();
                    }
                });

                // Theme toggle
                const themeToggle = document.getElementById('theme-toggle');
                if (themeToggle) {
                    themeToggle.addEventListener('click', () => this.toggleTheme());
                }
            }

            setupQuickActions() {
                const quickButtons = document.querySelectorAll('.quick-btn[data-action]');
                
                quickButtons.forEach(btn => {
                    btn.addEventListener('click', () => {
                        const action = btn.dataset.action;
                        const input = document.getElementById('input');
                        
                        if (!input) return;
                        
                        // Set command based on action
                        let command = '';
                        switch(action) {
                            case 'look':
                                command = 'look';
                                break;
                            case 'items':
                                command = 'items';
                                break;
                            case 'inventory':
                                command = 'inv';
                                break;
                            case 'go':
                                command = 'go';
                                break;
                            case 'help':
                                command = 'help';
                                break;
                            case 'save':
                                command = 'save';
                                break;
                            case 'load':
                                command = 'load';
                                break;
                            case 'clear':
                                this.clearOutput();
                                return;
                        }
                        
                        // Focus input, set value, and trigger command
                        input.focus();
                        input.value = command;
                        
                        // Trigger the original game engine's input handler
                        const event = new KeyboardEvent('keypress', {
                            key: 'Enter',
                            keyCode: 13,
                            which: 13,
                            bubbles: true,
                            cancelable: true
                        });
                        input.dispatchEvent(event);
                    });
                });
            }

            enhancePrintln() {
                // Override println to add modern UI enhancements
                if (typeof window.println === 'function') {
                    const originalPrintln = window.println;
                    const that = this;
                    
                    window.println = function(line, className) {
                        // Call original println first
                        originalPrintln.call(this, line, className);
                        
                        // Update current room if this is a room name
                        if (className === 'room-name' && line) {
                            that.currentRoom = line.replace(/<[^>]*>/g, ''); // Remove HTML tags
                            that.updateStatus();
                        }
                        
                        // Scroll to bottom
                        const output = document.getElementById('output');
                        if (output) {
                            setTimeout(() => {
                                output.scrollTop = output.scrollHeight;
                            }, 100);
                        }
                    };
                }
            }

            setupKeyboardShortcuts() {
                document.addEventListener('keydown', (e) => {
                    // Ctrl/Cmd + K to clear input
                    if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                        e.preventDefault();
                        const input = document.getElementById('input');
                        if (input) {
                            input.value = '';
                            input.focus();
                        }
                    }
                    
                    // Ctrl/Cmd + L to clear output
                    if ((e.ctrlKey || e.metaKey) && e.key === 'l') {
                        e.preventDefault();
                        this.clearOutput();
                    }
                });
            }

            clearOutput() {
                const output = document.getElementById('output');
                if (output) {
                    output.innerHTML = '<div class="output-line system">Output cleared. Ready for new input...</div>';
                }
            }

            toggleTheme() {
                this.isDarkMode = !this.isDarkMode;
                const themeToggle = document.getElementById('theme-toggle');
                
                if (this.isDarkMode) {
                    document.documentElement.style.setProperty('--background-color', '#0f172a');
                    document.documentElement.style.setProperty('--surface-color', '#1e293b');
                    document.documentElement.style.setProperty('--text-primary', '#f1f5f9');
                    document.documentElement.style.setProperty('--text-secondary', '#cbd5e1');
                    document.documentElement.style.setProperty('--text-muted', '#64748b');
                    document.documentElement.style.setProperty('--border-color', '#334155');
                    themeToggle.textContent = '‚òÄÔ∏è';
                } else {
                    // Reset to light mode (default values are already set)
                    document.documentElement.style.removeProperty('--background-color');
                    document.documentElement.style.removeProperty('--surface-color');
                    document.documentElement.style.removeProperty('--text-primary');
                    document.documentElement.style.removeProperty('--text-secondary');
                    document.documentElement.style.removeProperty('--text-muted');
                    document.documentElement.style.removeProperty('--border-color');
                    themeToggle.textContent = 'üåô';
                }
            }

            incrementCommandCount() {
                this.commandCount++;
                this.updateStatus();
            }

            updateStatus() {
                const roomElement = document.getElementById('current-room');
                const commandElement = document.getElementById('command-count');
                
                if (roomElement) {
                    roomElement.textContent = this.currentRoom;
                }
                
                if (commandElement) {
                    const count = this.commandCount;
                    commandElement.textContent = `${count} command${count !== 1 ? 's' : ''}`;
                }
            }

            startClock() {
                const updateTime = () => {
                    const timestampElement = document.getElementById('timestamp');
                    if (timestampElement) {
                        const now = new Date();
                        timestampElement.textContent = now.toLocaleTimeString();
                    }
                };
                
                updateTime();
                setInterval(updateTime, 1000);
            }
        }

        // Initialize Modern UI when DOM is ready
        window.modernUI = new ModernUI();
    </script>

    <!-- Load disk into engine -->
    <script>
        // Load the game after everything is ready
        if (typeof loadDisk === 'function' && typeof demoDisk === 'function') {
            console.log('Loading demo disk...');
            loadDisk(demoDisk);
        } else {
            console.error('Could not load game - missing functions');
        }
    </script>
</body>
</html>