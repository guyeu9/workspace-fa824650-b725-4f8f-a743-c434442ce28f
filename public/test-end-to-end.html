<!DOCTYPE html>
<html>
<head>
    <title>End-to-End Array Fix Test</title>
</head>
<body>
    <h1>Array Description Fix Test</h1>
    <button onclick="testGameLoad()">Test Game Loading</button>
    <div id="output" style="border: 1px solid #ccc; padding: 10px; margin-top: 10px; min-height: 200px;"></div>
    
    <script src="index.js"></script>
    <script>
        let testOutput = [];
        
        // Override println to capture output
        window.println = function(line, className) {
            // Handle array content by joining with newlines instead of random selection
            let processedLine = line;
            if (Array.isArray(line)) {
                console.log('Original println received array:', line);
                processedLine = line.join('\n\n');
                console.log('Processed to:', processedLine);
            }
            
            testOutput.push(processedLine);
            const outputDiv = document.getElementById('output');
            const p = document.createElement('p');
            p.textContent = processedLine;
            p.style.margin = '5px 0';
            outputDiv.appendChild(p);
        };
        
        function testGameLoad() {
            console.log('Starting end-to-end test...');
            testOutput = [];
            document.getElementById('output').innerHTML = '';
            
            // Test with array directly
            const testDesc = [
                "你站在星际飞船'希望号'的舰桥上。",
                "控制台闪烁着各种指示灯，主屏幕显示着求救信号的来源坐标。",
                "你需要决定如何响应这个神秘的信号。"
            ];
            
            console.log('Testing array description directly...');
            window.println(testDesc);
            
            setTimeout(() => {
                const outputText = document.getElementById('output').textContent;
                console.log('Final output:', outputText);
                
                if (outputText.includes('舰桥上') && 
                    outputText.includes('指示灯') && 
                    outputText.includes('信号')) {
                    console.log('✅ SUCCESS: All description lines are displayed');
                    alert('✅ Array description fix works correctly! All three lines are displayed.');
                } else {
                    console.log('❌ FAILURE: Not all description lines are displayed');
                    alert('❌ Array description fix failed. Some lines are missing.');
                }
            }, 500);
        }
    </script>
</body>
</html>