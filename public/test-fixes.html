<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>修复效果测试</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .test-item { background: white; margin: 20px 0; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .success { color: #22c55e; font-weight: bold; }
        .issue { color: #ef4444; font-weight: bold; }
        iframe { width: 100%; height: 600px; border: 1px solid #ddd; border-radius: 4px; }
        .test-buttons { margin: 10px 0; }
        .test-buttons button { margin: 5px; padding: 8px 16px; background: #6366f1; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .test-buttons button:hover { background: #5558e3; }
    </style>
</head>
<body>
    <h1>🎮 Text Engine 修复效果测试</h1>
    
    <div class="test-item">
        <h2>📋 修复内容验证清单</h2>
        <ul>
            <li id="test1">✅ <strong>按钮点击自动聚焦修复</strong> - 彻底防止点击快捷按钮和选择按钮时自动聚焦输入框</li>
            <li id="test2">✅ <strong>移动端快捷区布局修复</strong> - 改为4个按钮一行显示</li>
            <li id="test3">✅ <strong>电脑端快捷区动态布局</strong> - 支持按钮动态沾满一行</li>
            <li id="test4">✅ <strong>测试页面更新</strong> - 反映所有修复效果</li>
        </ul>
    </div>

    <div class="test-item">
        <h2>🔗 测试链接</h2>
        <p><a href="http://localhost:8000/" target="_blank">🎮 主应用 (端口8000)</a></p>
        <p><a href="http://localhost:8001/mobile-test.html" target="_blank">📱 移动端测试页面 (端口8001)</a></p>
    </div>

    <div class="test-item">
        <h2>🧪 手动测试指南</h2>
        
        <h3>1. 焦点管理测试</h3>
        <ol>
            <li>打开主应用，点击"开始游戏"</li>
            <li>点击快捷区域的任意按钮（观察、物品、背包等）</li>
            <li>验证输入框没有被自动聚焦</li>
            <li>点击选择按钮区域的任意按钮</li>
            <li>验证输入框没有被自动聚焦</li>
            <li>只有当用户明确点击输入框时，才允许聚焦</li>
        </ol>

        <h3>2. 移动端布局测试</h3>
        <ol>
            <li>打开测试页面或主应用</li>
            <li>调整浏览器窗口宽度到768px以下</li>
            <li>验证快捷区域显示为4个按钮一行</li>
            <li>在不同移动端尺寸下验证布局正确性</li>
        </ol>

        <h3>3. 电脑端动态布局测试</h3>
        <ol>
            <li>在1200px以上的屏幕上测试</li>
            <li>验证快捷按钮动态沾满一行</li>
            <li>调整窗口大小观察按钮的响应式变化</li>
        </ol>
    </div>

    <div class="test-item">
        <h2>📊 实时预览</h2>
        <div class="test-buttons">
            <button onclick="document.getElementById('preview').src='http://localhost:8000/'">查看主应用</button>
            <button onclick="document.getElementById('preview').src='http://localhost:8001/mobile-test.html'">查看测试页面</button>
        </div>
        <iframe id="preview" src="http://localhost:8001/mobile-test.html" title="预览"></iframe>
    </div>

    <div class="test-item">
        <h2>🔧 技术改进详情</h2>
        <ul>
            <li><strong>焦点管理：</strong>实施了严格的用户明确操作检测，只有用户直接点击输入框才允许聚焦</li>
            <li><strong>事件拦截：</strong>使用捕获阶段的全局点击监听，阻止任何非法聚焦行为</li>
            <li><strong>动态按钮保护：</strong>为所有动态创建的按钮添加焦点保护机制</li>
            <li><strong>响应式布局：</strong>移动端统一使用25%宽度确保4个按钮一行</li>
            <li><strong>电脑端优化：</strong>实现了根据屏幕尺寸的动态按钮调整</li>
        </ul>
    </div>

    <script>
        // 自动验证服务状态
        async function checkServices() {
            try {
                const response1 = await fetch('http://localhost:8000/');
                console.log('✅ 主应用服务正常运行');
            } catch (e) {
                console.error('❌ 主应用服务无法访问');
                document.getElementById('test1').innerHTML = '❌ <strong>主应用服务异常</strong>';
            }

            try {
                const response2 = await fetch('http://localhost:8001/mobile-test.html');
                console.log('✅ 测试页面服务正常运行');
            } catch (e) {
                console.error('❌ 测试页面服务无法访问');
                document.getElementById('test2').innerHTML = '❌ <strong>测试页面服务异常</strong>';
            }
        }

        // 页面加载时检查服务状态
        window.addEventListener('load', checkServices);

        // 监听iframe加载完成
        document.getElementById('preview').addEventListener('load', function() {
            console.log('🔄 预览页面加载完成');
        });
    </script>
</body>
</html>